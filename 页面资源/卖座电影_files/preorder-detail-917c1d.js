webpackJsonp([21],{737:function(e,t,a){"use strict";var r=(a(143),a(229)),n=a(386),s=r.createClass({displayName:"ConfirmButton",propTypes:{children:r.PropTypes.node,disabled:r.PropTypes.bool,onClick:r.PropTypes.func,className:r.PropTypes.string},handleClick:function(e){this.props.disabled||(this.props.onClick||function(){})(e)},render:function(){var e=n({"cpn-primary-button":!0,disabled:this.props.disabled});return r.createElement("button",{className:e+" "+(this.props.className||""),onClick:this.handleClick},this.props.children)}});e.exports=s},821:function(e,t,a){"use strict";var r=(a(143),a(229)),n=a(590),s=r.createClass({displayName:"CheckBox",propTypes:{onClick:r.PropTypes.func,checked:r.PropTypes.bool,disabled:r.PropTypes.bool},getDefaultProps:function(){return{onClick:function(){},checked:!1,disabled:!1}},handleClick:function(){this.props.disabled||this.props.onClick()},render:function(){var e=this.props.checked;return r.createElement("div",{className:"cpn-check-box "+(this.props.className||"")+(this.props.disabled?" disabled":""),onClick:this.handleClick},r.createElement("div",{className:"box"},e?r.createElement(n,null,"check"):""))}});e.exports=s},838:function(e,t,a){"use strict";var r=a(229),n=(a(212),a(5)),s=a(167),i=a(226).hasLogged,c=a(226).isMainAccount,l=a(226).toLogin,o=a(591),u=a(592).StoreWatchMixin,d=a(839),m=a(141),p=r.createClass({displayName:"PreorderView",mixins:[o,u("PreorderStore")],getStateFromFlux:function(){var e=this.getFlux().store("PreorderStore");return{preorder:e.getPreorder()}},componentDidMount:function(){var e=this.props.id,t=this.getFlux();return i()&&!c()?window.history.go(-1):(t.actions.preorder.get(e).then(function(a){var r,i,c,l,o,u,d;a=n(a),l=a.get("seat.seats"),r=a.get("seat.schedule.id"),o=!!a.get("exchange.count"),u=!!~[m.ITEM_TYPE_IS_BAOCHANG_TICKET,m.ITEM_TYPE_IS_YUWAN_TICKET].indexOf(a.get("seat.schedule.type")),d=!!~[m.ITEM_TYPE_IS_CARD_TICKET].indexOf(a.get("card.type")),i=o?a.get("exchange.id"):l?a.get("seat.schedule.item.id"):"",c=a.get("active.id"),s.get("PRIVILEGE.DISCOUNT")&&s.get("PRIVILEGE.COUPON")&&s.get("PRIVILEGE.CARD")&&s.get("PRIVILEGE.COIN")&&(u||d||t.actions.preorder.getRedeemSuggestion(e)),r&&t.actions.schedule.get(r),i&&t.actions.item.get(i).then(function(e){var a;e=n(e),a=e.get("extra.exchangeTicket.cinema.id")||"",a&&t.actions.cinema.get(a)}),c&&t.actions.active.get(c),t.actions.me.get(),d||(t.actions.card.list(e),t.actions.coupon.listToPreorder(e),t.actions.card.getCardValidToOrder(e)),u||d||t.actions.discount.listByPreorder(a.get("id"))}),setTimeout(function(){t.actions.application.setNavbar({title:"确认订单"})},0),void zhuge.track("检查确认订单"))},componentDidUpdate:function(){if(!i())return l()},render:function(){var e=this.state.preorder;return r.createElement("section",{className:"preorder-detail-view"},r.createElement(d,{preorder:e}))}});e.exports=p},839:function(e,t,a){"use strict";var r=a(229),n=a(5),s=a(389),i=(a(143),a(141),a(226).currency),c=a(226).isMobile,l={INVALID_PHONENUM:"手机号码格式有误",SECURITY_CODE_WARN:"请输入安全密码",SET_BIND_WARN:"为了您账户的安全，请先绑定手机号，并设置安全密码",SET_SECURITY_CODE_WARN:"为了您账户的安全，请设置安全密码"},o=a(591),u=a(592).StoreWatchMixin,d=a(840),m=a(841),p=a(842),h=a(843),g=a(845),E=a(846),f=a(847),C=a(737),N=a(848),v=a(850),y=a(226).redirect,S=a(226).toSetSecurityMobile,T=a(226).toSetSecurityCode,x=(a(742),a(569)),k=r.createClass({displayName:"Summation",render:function(){var e=this.props.pay,t=n(this.props.preorder),a=n.get(e.redeem,"coin.value"),s=+n.get(e.redeem,"card.value")||0,c=+n.get(e.redeem,"coupon.value")||0,l=+n.get(e,"discount.value")||0,o=s+c+l,u=[];return o&&u.push(t.get("sundries.length")&&!t.get("seat.seats.length")?"小卖品优惠"+o+"元":"影票优惠"+o+"元"),a&&u.push("余额抵扣"+a+"元"),r.createElement("div",{className:"summation-coupon"},r.createElement("div",null,"订单总额",r.createElement("span",{className:"price"},"¥",i(e.summation))),r.createElement("div",null,"优惠&抵扣",r.createElement("span",{className:"tip"},"- ¥ ",i((o||0)+(a||0)))),r.createElement("span",{className:"tips-selected"},u.join("+")))}}),b=r.createClass({displayName:"Confirm",mixins:[o,u("PreorderStore","RequestStore","MeStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore"),a=t.isSeatTicket(),r=t.isBaochangTicket(),s=t.isExchangeTicket(),i=t.isSundryTicket(),c=t.isActiveTicket(),l=t.isCardTicket(),o=t.getScheduleId(),u=t.getPay().redeem,d=n.has(u,"card.cards.0")&&t.isAllBindCards()||n.get(u,"coin.value");return{preorder:t.getPreorder(),mobile:t.getMobile(),hasCreated:t.hasCreated(),isUsingRedeem:t.isUsingRedeem(),ensureRequest:e.store("RequestStore").getRequest("PREORDER_GET_SEAT_TICKET_STATUS"),updateRequest:e.store("RequestStore").getRequest("PREORDER_UPDATE"),account:e.store("MeStore").getMe(),isSeatTicket:a,isBaochangTicket:r,isExchangeTicket:s,isSundryTicket:i,isActiveTicket:c,isCardTicket:l,schedule:a?e.store("ScheduleStore").getSchedule(o).attributes:{},paymentValue:t.getPaymentValue(),pay:t.getPay(),isNeedSecurityCode:!!d,isAllBindCards:t.isAllBindCards()}},handleMobileChange:function(e){this.getFlux().actions.preorder.setMobile(e)},handleClickConfirm:function(e){var t=this,a=this.getFlux(),r=this.props.preorder,i=this.state.securityCode,c=this.state.isNeedSecurityCode&&!r.hasVerified,o=n.get(this.state.account.attributes,"setting.isSetSecurityCode"),u=n.get(this.state.account.attributes,"setting.securityMobile");return c&&!u?(alert(l.SET_BIND_WARN),S()):c&&!o?(alert(l.SET_SECURITY_CODE_WARN),T()):void s.resolve().then(function(){return a.actions.preorder.update(r.id,r.sundries,t.state.mobile,r,i)}).then(function(){if(t.state.isSeatTicket)return a.actions.preorder.ensureSeatTicketStatus(r.id)}).then(function(){y("#!/preorder/"+r.id+"/pay")})["catch"](function(e){e.message&&alert(e.message)})},handleSecurityCodeChange:function(e){this.setState({securityCode:e})},getInitialState:function(){return{securityCode:""}},componentDidMount:function(){this.getFlux().actions.me.get();var e=this;setTimeout(function(){var t=n.get(e.state.account.attributes,"setting.isSetSecurityCode");t&&e.state.isNeedSecurityCode&&!e.state.preorder.hasVerified?x.warning(l.SECURITY_CODE_WARN):""},1e3)},componentWillMount:function(){},isMobileInputAvailable:function(){return(!this.state.isSeatTicket||!this.state.schedule.isMobileRequiredForLocking)&&!this.state.isActiveTicket},render:function(){var e=this.state.pay,t=this.props.preorder,a=(t.seat.seats,this.state.ensureRequest.loading||this.state.updateRequest.loading),s=(this.state.isAllBindCards,n.get(this.state.account.attributes,"setting.isSetSecurityCode")),i=(n.get(this.state.account.attributes,"setting.securityMobile"),t.hasVerified),l=this.state.isNeedSecurityCode&&s&&!i,o=c(this.state.mobile)&&(!l||l&&6===this.state.securityCode.length),u=this.state.paymentValue,y=this.state.isSeatTicket?r.createElement(m,null):this.state.isBaochangTicket?r.createElement(p,null):this.state.isExchangeTicket?r.createElement(h,null):this.state.isSundryTicket?r.createElement(g,null):this.state.isActiveTicket?r.createElement(E,null):this.state.isCardTicket?r.createElement(f,null):null,S=this.state.isSeatTicket?"正在锁定座位":"正在加载中";return r.createElement("article",{className:"preorder-confirm"},y,r.createElement(d,{disabled:!this.isMobileInputAvailable(),defaultValue:this.state.mobile,onChange:this.handleMobileChange}),l?r.createElement(v,{isNeedSecurityCode:l,onChange:this.handleSecurityCodeChange,ref:"securitycode"}):null,r.createElement(N,{account:this.state.account.attributes,summation:this.state.pay.summation}),this.state.isCardTicket?null:r.createElement(k,{pay:e,preorder:t}),r.createElement(P,{isCardTicket:this.state.isCardTicket}),r.createElement("div",{className:"operation"},r.createElement("span",{className:"balance"},"待付金额：",r.createElement("span",{className:"cny"},"¥"),r.createElement("span",{className:"price"},u||0)),r.createElement(C,{className:"confirm",onClick:this.handleClickConfirm,disabled:!o||a},a?S:"确认")))}}),P=r.createClass({displayName:"CardNotice",render:function(){if(!this.props.isCardTicket)return null;var e=[r.createElement("li",{key:"card0"},"在新版APP中，使用此储值卡可搭配优惠活动或现金券使用。 具体使用规则请以活动详情为准；"),r.createElement("li",{key:"card1"},"活动期间每个手机号限购一张票哦，请确认号码无误，支付成功后将无法修改；"),r.createElement("li",{key:"card2"},"确认订单后，请在15分钟内完成支付，超时系统将释放订单。")];return r.createElement("div",{className:"card-notice"},r.createElement("ul",null,e))}});e.exports=b},840:function(e,t,a){"use strict";var r=a(229),n=a(590),s=11,i=1,c=r.createClass({displayName:"MobileInput",propTypes:{disabled:r.PropTypes.bool,defaultValue:r.PropTypes.string,onChange:r.PropTypes.func},getDefaultProps:function(){return{disabled:!1,defaultValue:"",onChange:function(){}}},handleChange:function(e){var t=this,a=e.target.value;a.length>s||setTimeout(function(){t.props.onChange(a)},0)},clearMobile:function(){var e=this;setTimeout(function(){e.props.onChange("")},0)},render:function(){var e=this.props.defaultValue;return r.createElement("div",{className:"mobile"+(this.props.disabled?" disabled":"")},r.createElement("label",null,"手机号："),r.createElement("input",{className:"input-mobile",type:"tel",name:"mobile",placeholder:"请输入手机号",value:e,onChange:this.handleChange,disabled:this.props.disabled,ref:"mobile"}),r.createElement(n,{className:"clear-mobile",hide:e<i||this.props.disabled,onClick:this.clearMobile},"close"))}});e.exports=c},841:function(e,t,a){"use strict";var r=a(229),n=a(438),s=a(5),i=(a(141),a(226).currency),c=a(226).redirect,l=a(591),o=a(592).StoreWatchMixin,u=a(167),d=a(590),m=r.createClass({displayName:"Information",mixins:[l,o("PreorderStore","ItemStore","ScheduleStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore"),a=t.getCinemaId();return{preorder:t.getPreorder(),cinemaId:a,schedule:e.store("ScheduleStore").getSchedule(t.getScheduleId()).attributes,sundries:e.store("ItemStore").getSundriesByCinema(a)}},handleClickSundry:function(){c("#!/preorder/"+this.state.preorder.id+"/sundry")},componentDidMount:function(){var e=this.state.cinemaId;setTimeout(function(){flux.store("ItemStore").hasListOfCinema(e)||flux.actions.item.patchByCinema(e)},0)},render:function(){var e=this.state.preorder,t=this.state.schedule,a=e.seat.seats||[],c=(i((s.get(t,"price.maizuo")+s.get(t,"price.premium")||0)*a.length),this.state.sundries),l=u.get("PRIVILEGE"),o=_.reduce(e.sundries,function(e,t){return(100*e+100*+i(t.price*t.count))/100},0),m=r.createElement("div",{className:"sundry-wrap",onClick:this.handleClickSundry},r.createElement("div",{className:"sundry-detail"},"小卖品"),r.createElement("div",{className:"sundry-total"},r.createElement(d,{className:"arrow"},"arrow-right")));if(e.sundries&&e.sundries.length>0){var p=e.sundries.map(function(e){return r.createElement("p",{key:e.id},e.name," × ",e.count)});m=r.createElement("div",{className:"sundry-wrap",onClick:this.handleClickSundry},r.createElement("div",{className:"sundry-detail"},p),r.createElement("div",{className:"sundry-total"},"原价：¥ ",o||0,r.createElement(d,{className:"arrow"},"arrow-right")))}return r.createElement("div",{className:"information seat-ticket"},r.createElement("div",{className:"detail"},r.createElement("h4",null,r.createElement("span",{className:"film"},s.get(t,"film.name")),r.createElement("span",{className:"imagery"},s.get(t,"imagery"))),r.createElement("p",null,s.get(t,"cinema.name")),r.createElement("p",null,s.get(t,"hall.name")),r.createElement("p",null,_.map(a,function(e){return r.createElement("span",{className:"seat",key:[e.rowName,e.columnName].join("-")},e.rowName+"排"+e.columnName+"座")})),r.createElement("p",{className:"show-time"},n(t.showAt).format("YYYY-MM-DD dddd HH:mm"))),l.SUNDRY&&c.length>0?m:null,r.createElement("div",{className:"summation"},r.createElement("p",null,r.createElement("span",{className:"cny"},"¥"),r.createElement("span",{className:"price",ref:"price"},i(e.summation-o))),r.createElement("p",null,"含服务费 ¥ ",i(s.get(t,"price.premium")),"/张")))}});e.exports=m},842:function(e,t,a){"use strict";var r=a(229),n=a(438),s=a(5),i=a(226).currency,c=a(591),l=a(592).StoreWatchMixin,o=r.createClass({displayName:"Information",mixins:[c,l("PreorderStore","ScheduleStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore");return{preorder:t.getPreorder(),schedule:e.store("ScheduleStore").getSchedule(t.getScheduleId()).attributes}},render:function(){var e=this.state.preorder,t=this.state.schedule,a=e.seat.seats||[],c=i((s.get(t,"price.maizuo")+s.get(t,"price.premium")||0)*a.length);return r.createElement("div",{className:"information baochang-ticket"},r.createElement("div",{className:"detail"},r.createElement("h4",null,r.createElement("span",{className:"film"},s.get(t,"film.name")),r.createElement("span",{className:"imagery"},s.get(t,"imagery"))),r.createElement("p",null,s.get(t,"cinema.name")),r.createElement("p",null,s.get(t,"hall.name")),r.createElement("p",null,_.map(a,function(e){return r.createElement("span",{className:"seat",key:[e.rowName,e.columnName].join("-")},e.rowName+"排"+e.columnName+"座")})),r.createElement("p",{className:"show-time"},n(s.get(t,"baochang.startFrom")).format("YYYY-MM-DD HH:mm")+" - "+n(s.get(t,"baochang.startTo")).format("HH:mm"))),r.createElement("div",{className:"summation"},r.createElement("p",null,r.createElement("span",{className:"cny"},"¥"),r.createElement("span",{className:"price",ref:"price"},c)),r.createElement("p",null,"含服务费 ¥ ",i(s.get(t,"price.premium")),"/张")))}});e.exports=o},843:function(e,t,a){"use strict";var r=a(143),n=a(229),s=a(438),i=a(5),c=(a(131),a(389)),l=a(226).currency,o=(a(590),a(844)),u=(a(141),a(591)),d=a(592).StoreWatchMixin,m=2,p=10,h=1,g=n.createClass({displayName:"Information",mixins:[u,d("CinemaStore","PreorderStore","ItemStore")],propTypes:{},updatePreorderExchangeCount:r.debounce(function(e){var t=this.state.preorder,a=this.state.preorder.id,r=this.state.preorder.mobile||"";return c.resolve().then(function(){return flux.actions.preorder.resetRedeem()}).then(function(){return flux.actions.preorder.update(a,[],r,t,"",e)}).then(function(){return flux.actions.cardSolution.resolve(t,[])})["catch"](function(e){e.message&&alert(e.message)})},400),handleCountChange:function(e){this.setState({count:e}),this.updatePreorderExchangeCount(e)},getInitialState:function(){return{count:m}},getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore"),a=t.getExchangeTicket().id,r=a?e.store("ItemStore").getItem(a).attributes:{},n=i.get(r,"extra.exchangeTicket.cinema.id");return{preorder:t.getPreorder(),exchange:r,cinema:n?e.store("CinemaStore").getCinema(n).attributes:{}}},render:function(){var e=this.state.exchange,t=l((i.get(e,"price.maizuo")||0)*(i.get(this.state.preorder,"exchange.count")||this.state.count));return n.createElement("div",{className:"information exchange-ticket"},n.createElement("div",{className:"detail"},n.createElement("h4",null,this.state.cinema.name),n.createElement("p",null,"有效期至：",s(i.get(e,"validDate.endAt")).format("YYYY-MM-DD")),n.createElement("p",null,"票品：",e.name),n.createElement("p",null,"票数：",n.createElement(o,{defaultValue:i.get(this.state.preorder,"exchange.count")||this.state.count,max:p,min:h,onChange:this.handleCountChange}))),n.createElement("div",{className:"summation"},n.createElement("span",{className:"cny"},"¥"),n.createElement("span",{className:"price",ref:"price"},t),n.createElement("span",{className:"count"},"¥ ",l(i.get(e,"price.maizuo")),"  × ",i.get(this.state.preorder,"exchange.count")||this.state.count)))}});e.exports=g},844:function(e,t,a){"use strict";var r=(a(143),a(229)),n=a(590),s=(a(226).currency,1),i=0,c=5,l=r.createClass({displayName:"Counter",propTypes:{onChange:r.PropTypes.func,defaultValue:r.PropTypes.number,value:r.PropTypes.number,step:r.PropTypes.number,max:r.PropTypes.number,min:r.PropTypes.number},getDefaultProps:function(){return{step:s,min:i,max:c}},getInitialState:function(){return{value:this.props.value||this.props.defaultValue||0}},_setValue:function(e){var t=this;e!==this.state.value&&(this.setState({value:e}),setTimeout(function(){t.props.onChange(e)},0))},plus:function(){var e=this.state.value;this._setValue(Math.min(this.props.max,e+this.props.step))},subtract:function(){var e=this.state.value;this._setValue(Math.max(this.props.min,e-this.props.step))},render:function(){var e=this.state.value;return r.createElement("span",{className:"cpn-counter"},r.createElement("span",{className:"subtract",onTouchTap:this.subtract},r.createElement(n,null,"reduce-filled")),r.createElement("span",{className:"number"}," ",e," "),r.createElement("span",{className:"plus",onTouchTap:this.plus},r.createElement(n,null,"add-filled")))}});e.exports=l},845:function(e,t,a){"use strict";var r=a(229),n=a(438),s=a(5),i=a(226).currency,c=a(591),l=a(592).StoreWatchMixin,o=(a(590),a(167),a(226).redirect,a(141),r.createClass({displayName:"Information",mixins:[c,l("PreorderStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore");return{sundries:t.getSundries()}},render:function(){var e=this.state.sundries,t=s.get(e,"0.expireAt"),a=_.reduce(e,function(e,t){return(100*e+100*+i(t.price*t.count))/100},0);return r.createElement("div",{className:"information sundry-ticket"},r.createElement("div",{className:"detail"},r.createElement("h4",null,"小卖品"),r.createElement("p",null,s.get(e,"0.cinema.name")),r.createElement("p",null,"有效期至: ",t?n(t).format("YYYY-MM-DD"):""),_.map(e,function(e){return r.createElement("p",{key:e.id},e.name," × ",e.count)})),r.createElement("div",{className:"summation"},r.createElement("p",null,r.createElement("span",{className:"cny"},"¥"),r.createElement("span",{className:"price",ref:"price"},a||""))))}}));e.exports=o},846:function(e,t,a){"use strict";var r=a(229),n=a(438),s=a(5),i=a(226).currency,c=a(591),l=a(592).StoreWatchMixin,o=r.createClass({displayName:"Information",mixins:[c,l("PreorderStore","ActiveStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore"),a=t.getActiveTicket().id;return{preorder:t.getPreorder(),active:a?e.store("ActiveStore").getActive(a).attributes:{}}},render:function(){var e=s(this.state.preorder),t=s(this.state.active),a=e.get("active.count"),c=i((t.get("price.maizuo")||0)*a);return r.createElement("div",{className:"information active-ticket"},r.createElement("div",{className:"detail"},r.createElement("h4",null,t.get("name")),r.createElement("p",null,"有效期：",n(t.get("item.validDate.startAt")).format("YYYY-MM-DD")," 至 ",n(t.get("item.validDate.endAt")).format("YYYY-MM-DD")),r.createElement("p",null,"票品：",t.get("item.name")),r.createElement("p",null,"数量： ",a)),r.createElement("div",{className:"summation"},r.createElement("span",{className:"cny"},"¥"),r.createElement("span",{className:"price",ref:"price"},c),r.createElement("span",{className:"count"},"¥ ",i(t.get("price.maizuo")||0),"  × ",a)))}});e.exports=o},847:function(e,t,a){"use strict";var r=a(229),n=a(438),s=a(5),i=(a(226).currency,a(591)),c=a(592).StoreWatchMixin,l=r.createClass({displayName:"Information",mixins:[i,c("PreorderStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore");return{preorder:t.getPreorder()}},componentDidMount:function(){},render:function(){var e=s(this.state.preorder);return r.createElement("div",{className:"information card-ticket"},r.createElement("div",{className:"card-wrapper"},r.createElement("p",null,"¥",r.createElement("span",{className:"card-value"},e.get("card.price")),"积分卡"),r.createElement("div",{className:"card-desc"},"有效期：",n().format("YYYY-MM-DD")," 至 ",n(e.get("card.expireAt")).format("YYYY-MM-DD"))),r.createElement("div",{className:"card-summation"},"订单金额：",r.createElement("span",{className:"cny"},"¥",(e.get("card.price")-e.get("card.discount")).toFixed(2))))}});e.exports=l},848:function(e,t,a){"use strict";var r=a(229),n=a(5),s=a(143),i=a(590),c=a(821),l=a(226).currency,o=a(591),u=a(592).StoreWatchMixin,d=a(226).redirect,m=a(167),p=a(569),h=a(849),g="该<%- current %>不能与<%- next %>同时使用，使用<%- next %>会取消<%- current %>的优惠资格",E=r.createClass({displayName:"Redeem",propTypes:{account:r.PropTypes.object,summation:r.PropTypes.number},mixins:[o,u("PreorderStore","DiscountStore","CouponStore","BillingStore","RequestStore")],getCoin:function(){return n.get(this.props.account,"wallet.coin")||0},switchRedeemTo:function(e){var t=this.getFlux(),a=function(e){return{DISCOUNT:"优惠活动",CARD:m.tpl("{{CARD}}/预售卡"),COUPON:"现金券"}[e]},r=function(){switch(e){case"DISCOUNT":d(window.location.hash+"/discount");break;case"CARD":d(window.location.hash+"/card");break;case"COUPON":d(window.location.hash+"/coupon")}},i=n.get(this.state,"pay.discount.value")?"DISCOUNT":n.get(this.state,"pay.redeem.card.value")?"CARD":n.get(this.state,"pay.redeem.coupon.value")?"COUPON":null;if(!i||i===e)return r();var c=s.template(g)({current:a(i),next:a(e)});if(confirm(c)){switch(i){case"DISCOUNT":t.actions.preorder.setDiscount();break;case"CARD":t.actions.cardSolution.resolve(null,[]).then(function(){t.actions.preorder.confirmCardSolutionCancel()});break;case"COUPON":t.actions.preorder.setCoupon()}r()}},handleClickDiscount:function(){return 0==this.state.discounts.length?p.warning("当前无优惠可用"):void this.switchRedeemTo("DISCOUNT")},handleClickCard:function(){this.switchRedeemTo("CARD")},handleClickCoupon:function(){this.switchRedeemTo("COUPON")},handleClickCoin:function(){var e=this.state.pay.redeem.coin.value?0:this.getCoin();this.getFlux().actions.preorder.setCoin(e)},getStateFromFlux:function(){var e=this.getFlux(),t=e.store("DiscountStore"),a=e.store("CouponStore"),r=e.store("PreorderStore"),n=e.store("BillingStore"),s=e.store("RequestStore"),i=e.store("CardStore");return{discounts:t.getDiscountsByPreorder(r.getId()).models,coupons:a.getCoupons(),pay:r.getPay(),validCard:i.getCardValidToOrder(r.getId()),isPaying:n.isPaying(),isSeatTicket:r.isSeatTicket(),isBaochangTicket:r.isBaochangTicket(),isSundryTicket:r.isSundryTicket(),isExchangeTicket:r.isExchangeTicket(),isCardTicket:r.isCardTicket(),isLoading:s.getRequest("PREORDER_GET_REDEEM_SUGGESTION").loading||s.getRequest("PREORDER_UPDATE").loading||s.getRequest("PREORDER_GET").loading}},componentDidMount:function(){},render:function(){var e=this.state.pay,t=e.redeem,a=e.payment,n=this.getCoin(),s=this.state.coupons.length,o=this.state.discounts.length,u=this.state.pay.discount.name,d=this.state.pay.discount.value,p=t.coin.value,g=t.card.value,E=t.coupon.value,f=this.state.validCard.total||0,C=this.state.isPaying,N=this.state.isLoading,v=this.state.isSeatTicket,y=this.state.isBaochangTicket,S=this.state.isSundryTicket,T=this.state.isExchangeTicket,x=this.state.isCardTicket,k=m.get("PRIVILEGE");return x?null:r.createElement("article",{className:"redeem"},r.createElement("ul",null,r.createElement(h,{title:u||"优惠活动",className:"discount",selected:!!d,disabled:C||N||!o&&!d,onClick:this.handleClickDiscount,hide:!v&&!S||!k.DISCOUNT},d?r.createElement("span",{className:"tip selected"},"该单优惠",l(d),"元"):r.createElement("span",{className:"tip"},o?"有"+o+"个优惠":"暂无优惠"),r.createElement(i,{className:"arrow"},"arrow-right")),r.createElement(h,{title:m.tpl("{{CARD}}/预售卡"),className:"card",selected:!!g,disabled:C||N,onClick:this.handleClickCard,hide:!v&&!y&&!T&&!S||!k.CARD},g?r.createElement("span",{className:"tip selected"},"已抵扣",l(g),"元"):r.createElement("span",{className:"tip"},f," 张可用"),r.createElement(i,{className:"arrow"},"arrow-right")),r.createElement(h,{title:"现金券",className:"coupon",selected:!!E,disabled:C||N||!s,onClick:this.handleClickCoupon,hide:!v&&!S||!k.COUPON},E?r.createElement("span",{className:"tip selected"},"已抵扣 ¥ ",l(E)):r.createElement("span",{className:"tip"},s," 张可用"),r.createElement(i,{className:"arrow"},"arrow-right")),r.createElement(h,{title:"账户余额",className:"coin",selected:!!p,disabled:C||N||!n,onClick:this.handleClickCoin,hide:!k.COIN},p?r.createElement("div",{className:"tip selected"},"抵扣 ¥ ",l(p)):r.createElement("span",{className:"tip"},"¥ ",l(n)),r.createElement(c,{className:"checkbox",checked:!!p,disabled:!n||!a.value&&!p||C||N}))))}});e.exports=E},849:function(e,t,a){"use strict";var r=a(229),n=a(386),s=r.createClass({displayName:"Tab",propTypes:{disabled:r.PropTypes.bool,onClick:r.PropTypes.func,className:r.PropTypes.string,title:r.PropTypes.string,hide:r.PropTypes.bool,children:r.PropTypes.node,selected:r.PropTypes.bool},getDefaultProps:function(){return{disabled:!1,onClick:function(){},className:"",title:"",hide:!1,children:"",selected:!1}},handleClick:function(){this.props.disabled||this.props.hide||this.props.onClick()},render:function(){return r.createElement("li",{className:n(this.props.className,{disabled:this.props.disabled,hide:this.props.hide,selected:this.props.selected}),onClick:this.handleClick},r.createElement("span",{className:"title"},this.props.title),r.createElement("div",{className:"right"},this.props.children))}});e.exports=s},850:function(e,t,a){"use strict";var r=a(229),n=a(143),s=(a(226).redirect,a(226).toSetSecurityCode),i=6,c=r.createClass({displayName:"SecurityCodeView",propTypes:{onChange:r.PropTypes.func,defaultSecurityCode:r.PropTypes.string},getInitialState:function(){return{securityCodeLength:0,codeFocus:!1}},codeChange:function(e){var t=this,a=e.target.value,r=a.length;t.setState({securityCodeLength:r}),setTimeout(function(){t.props.onChange(a)},0)},handleFoget:function(){return s()},handleFocus:function(e){return"focus"===e?(this.setState({codeFocus:!0}),this.refs.securitycode.focus()):this.setState({codeFocus:!1})},componentDidMount:function(){this.refs.securitycode.value=""},render:function(){var e,t=this,a=[],s=this.state.securityCodeLength;for(e=0;e<i;e++)a.push(r.createElement("li",{key:"pwd"+e},e<s?"*":t.state.codeFocus&&e===s?r.createElement("span",null):null));return r.createElement("div",{className:"payment-code"},r.createElement("div",null,r.createElement("input",{className:"code-input",type:"tel",pattern:"\\d*",onChange:this.codeChange,ref:"securitycode",maxLength:"6",onBlur:this.handleFocus}),r.createElement("label",null,"安全密码："),r.createElement("ul",{onClick:n.partial(this.handleFocus,"focus")},a)),r.createElement("div",{className:"payment-forget"},r.createElement("span",{onClick:this.handleFoget},"忘记密码？")))}});e.exports=c},851:function(e,t,a){"use strict";var r=a(229),n=a(5),s=(a(212),a(141),a(591)),i=a(592).StoreWatchMixin,c=(a(726),a(226).redirect),l=a(226).hasLogged,o=a(226).toLogin,u=a(737),d=a(852),m=a(853),p=a(167),h=r.createClass({displayName:"PreorderDetailView",mixins:[s,i("PreorderStore","RequestStore")],getStateFromFlux:function(){var e=this.getFlux(),t=e.store("PreorderStore"),a=e.store("RequestStore");return{request:a.getRequest("PREORDER_GET"),preorder:t.getPreorder(),paymentValue:t.getPaymentValue()}},componentDidMount:function(){var e=this.getFlux(),t=this.props.id;return l()?(e.actions.preorder.get(t),void this.getFlux().actions.application.setNavbar({title:p.tpl("确认订单")})):o()},handleSubmit:function(){var e=n(this.state.preorder);c("#!/preorder/"+e.get("id")+"/card-extension/pay")},render:function(){var e=this.state.request,t=this.state.paymentValue,a=this.state.preorder;return r.createElement("section",{className:"card-extension-view"},r.createElement(d,null),r.createElement(m,{preorder:a}),r.createElement("article",{className:"operation"},r.createElement("span",{className:"balance"},"待付金额：",r.createElement("span",{className:"cny"},"¥"),r.createElement("span",{className:"price"},t||0)),r.createElement(u,{onClick:this.handleSubmit,disabled:e.loading,className:"confirm"},"确认")))}});e.exports=h},852:function(e,t,a){"use strict";var r=a(229),n=a(438),s=a(5),i=a(167),c=a(226).currency,l=a(591),o=a(592).StoreWatchMixin,u=(r.createClass({displayName:"Title",render:function(){return r.createElement("span",{className:"title"},this.props.children)}}),r.createClass({displayName:"Information",mixins:[l,o("PreorderStore")],getStateFromFlux:function(){var e=flux.store("PreorderStore");return{preorder:e.getPreorder(),paymentValue:e.getPaymentValue()}},render:function(){var e=s(this.state.preorder),t=e.get("card.item.extension.date"),a=e.get("card.item.code")+"";return r.createElement("div",null,r.createElement("div",{className:"information"},r.createElement("div",{className:"title"},r.createElement("p",null,i.tpl("{{CARD}}延期服务"),r.createElement("span",{className:"card-value"},"¥ "+c(e.get("card.price"))+"/30天"))),r.createElement("div",null,r.createElement("label",null,i.tpl("{{CARD}}")),r.createElement("span",null,a)),r.createElement("div",null,r.createElement("label",null,"原有效期"),r.createElement("span",null,n(e.get("card.validDate.startAt")).format("YYYY-MM-DD")+" 至 "+n(e.get("card.validDate.endAt")).format("YYYY-MM-DD"))),r.createElement("div",null,r.createElement("label",null,"过期时长"),r.createElement("span",null,t+"天（按"+30*Math.ceil(t/30)+"天计费）")),r.createElement("div",null,r.createElement("label",null,"有效期至"),r.createElement("span",null,n(e.get("card.item.extension.endAt")).format("YYYY-MM-DD")))),r.createElement("div",{className:"summation"},"订单总额",r.createElement("span",{className:"cny"},"¥ ",this.state.paymentValue)))}}));e.exports=u},853:function(e,t,a){"use strict";var r=a(229),n=a(143),s=a(5),i=a(226).currency,c=a(167),l=r.createClass({displayName:"Notice",render:function(){var e=s(this.props.preorder),t=i(e.get("card.price")),a=e.get("card.item.isBinded");return r.createElement("div",{className:"notice"},r.createElement("div",{className:"title"},r.createElement("p",null,"付费延期说明")),r.createElement("ul",null,n.isUndefined(a)?null:a?r.createElement("li",null,r.createElement("p",null,c.tpl("{{CARD}}过期后，额外延长使用时间需付费"))):r.createElement("li",null,r.createElement("p",null,c.tpl("未绑定{{CARD}}过期后，额外延长使用时间需付费"))),r.createElement("li",null,r.createElement("p",null,"已过期超过180天的卡不予延期")),r.createElement("li",null,r.createElement("p",null,"收费标准：根据过期时长收费，",t,"元/30天/卡，不足30天按30天计算")),n.isUndefined(a)?null:a?r.createElement("li",null,r.createElement("p",null,"付费后有效期以付费时间为起点延后30天")):r.createElement("li",{className:"highlight"},r.createElement("p",null,"付费后有效期以付费时间为起点延后30天,并自动绑定到当前账户")),r.createElement("li",null,r.createElement("p",null,"每张卡只能延期1次")),r.createElement("li",null,r.createElement("p",null,"每个账户每天延期不超过6张卡"))))}});e.exports=l}});